<div class="opti_container position-relative bg-white rounded">
    <form class="form-with-fix-btnBar" *ngIf="!viewLines">
        <div class="opti_container_inner" [perfectScrollbar]=" ">

            <h3 class="border-bottom d-flex pt-1 pb-3 mb-4">
                {{pageTitle}}
            </h3>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12 col-lg-8 col-xl-6">
                    <div class="form-group row" *ngIf="deliveryOptionType==2">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'Outbound_Customer'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #scanCustomerCode (blur)="onCustomerCodeBlur()" id="outCustomerCustomerCodeInput" [disabled]='orderCollection!=undefined && orderCollection!=null && orderCollection.length > 0'
                                    type="text" class="form-control form-control-sm" name='customerCode' [(ngModel)]="customerCode"
                                    placeholder="{{'Outbound_Customer'|translate}}">
                                <div class="input-group-append">
                                    <button tabIndex="-1" [disabled]=' orderCollection!=undefined && orderCollection!=null && orderCollection.length>0' class="k-button k-primary btn"
                                        (mousedown)="openCustomerLookup()" type="button">
                                        <i class="opti-icon-search"></i>
                                    </button>
                                </div>

                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outCustomerCuCodeScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row" *ngIf="false">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'ShipmentID'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #scanShipmentId (blur)="onShipmentBlur()" id="outCustomerCustomerCodeInput" type="text" class="form-control form-control-sm"
                                    name='shipmentCode' [(ngModel)]="shipmentId" placeholder="{{'ShipmentID'|translate}}">
                                <div class="input-group-append">
                                    <button tabIndex="-1" class="k-button k-primary btn" (mousedown)="getShipmentList()" type="button">
                                        <i class="opti-icon-search"></i>
                                    </button>
                                    <button tabIndex="-1" class="k-button k-primary btn separate-btn ship-btn" type="button" (mousedown)="showShipments()">
                                        <i class="opti-icon-view-batch mr-1"></i>{{'Shipment_Detail'|translate}}
                                    </button>
                                </div>

                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outCustomerCuCodeScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row" *ngIf="deliveryOptionType==1">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'Outbound_Customer'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #scanCustomerCode (blur)="onCustomerCodeBlur()" id="outCustomerCustomerCodeInput" [disabled]='orderCollection!=undefined && orderCollection!=null && orderCollection.length > 0'
                                    type="text" class="form-control form-control-sm" name='customerCode' [(ngModel)]="customerCode"
                                    placeholder="{{'Outbound_Customer'|translate}}">
                                <div class="input-group-append">
                                    <button tabIndex="-1" [disabled]=' orderCollection!=undefined && orderCollection!=null && orderCollection.length>0' class="k-button k-primary btn"
                                        (mousedown)="openCustomerLookup()" type="button">
                                        <i class="opti-icon-search"></i>
                                    </button>
                                </div>

                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outCustomerCuCodeScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==1">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'Name'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control form-control-sm" name="customerName" value="{{customerName}}" placeholder="{{'Outbound_CustomerName'|translate}}"
                                    [disabled]="true">
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==2">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'PT_Ship_To'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #shipTo (blur)="isValidShipTo()" id="outshipToNoInput" type="text" class="form-control form-control-sm" name='shipToCode'
                                    [(ngModel)]="shipToCode" placeholder="{{'PT_Ship_To'|translate}}">
                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outshipToScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==2">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'outbound_Dock_DoorNo'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #dockDoorID (blur)="onDockDoorBlur()" id="outDockDoorNoInput" type="text" class="form-control form-control-sm" name='DockDoorCode'
                                    [(ngModel)]="dockDoorCode" placeholder="{{'outbound_Dock_DoorNo'|translate}}">
                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outDockDoorScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==1">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'Outbound_SO'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #scanSO (blur)="onOrderNoBlur()" type="text" class="form-control form-control-sm" name='orderNumber' [(ngModel)]="orderNumber"
                                    id="outCustomerSOInput" placeholder="{{'Outbound_SO'|translate}}">
                                <div class="input-group-append">
                                    <button tabIndex="-1" class="k-button k-primary btn" (mousedown)="openOrderLookup()" type="button">
                                        <i class="opti-icon-search"></i>
                                    </button>
                                </div>
                                <div class="ml-1 d-flex">
                                    <button tabIndex="-1" type="button" id="outCustomerSOScan" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                                        <i class="opti-icon-qr-code fs-24"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==1">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'TrackingId'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input #scanTracking (blur)="trackingIdBlur()" type="text" class="form-control form-control-sm" name="trackingId" [(ngModel)]="trackingId"
                                    placeholder="{{'EnterTrackingId'|translate}}">
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="deliveryOptionType==1">
                        <label for="inputPassword" class="col-sm-3 col-form-label">{{'CustomerRefNo'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input type="text" (blur)="customerRefNoBlur()" class="form-control form-control-sm" name="custRefNo" [(ngModel)]="CustRefNo"
                                    placeholder="{{'EnterCustomerRefNo'|translate}}">
                            </div>
                        </div>
                    </div>

                    <!-- <div class="form-group row" *ngIf="deliveryOptionType==2">
                        <label class="custom-control-label" for="UseContainer">{{'Cont_Shipment'|translate}}</label>
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <input type="checkbox" id="UseContainer" (change)="onCheckChange()" class="custom-control-input" name="UseContainer" [(ngModel)]=UseContainer
                                />
                            </div>
                        </div>
                    </div> -->

                    <div class="form-group row" *ngIf="deliveryOptionType==2">
                        <div class="col-sm-9">
                            <div class="input-group input-group-sm">
                                <button type="button" (click)="onQueryClick()">{{'Query'|translate}}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" *ngIf="deliveryOptionType==2">
                <div class="col-12">
                    <kendo-grid class="no-shadow" [kendoGridBinding]="DiliveryShipmentList" [resizable]="true" [pageSize]="pageSize" [pageable]="pagable"
                        (pageChange)="pageChange($event)" [sortable]="true" [filterable]=isColumnFilter [groupable]=isColumnGroup
                        [height]=gridHeight (selectionChange)="onShipmentSelection($event)" [skip]="skip" [selectable]="true"
                        #gridItem>

                        <ng-template kendoGridToolbarTemplate>
                            <span class="grid-toolbar-title">{{'SelectShipmentForDelivery'|translate}}</span>
                        </ng-template>

                        <kendo-grid-checkbox-column title="{{'Select'|translate}}" [width]="15">
                            <ng-template kendoGridHeaderTemplate let-column let-rowIndex="rowIndex">
                                <div class="k-form-field d-flex">
                                    <input type="checkbox" #Selectallcheckedvalue (change)="on_Selectall_checkbox_checked(Selectallcheckedvalue.checked)" id="parent_checkbox_{{rowIndex}}"
                                        [checked]=selectall class="k-checkbox" />
                                    <label class="k-checkbox-label" for="parent_checkbox_{{rowIndex}}"></label>
                                </div>
                            </ng-template>
                            <ng-template kendoGridCellTemplate let-idx='rowIndex' let-dataItem='dataItem'>
                                <!-- <div class="k-form-field d-flex">
                                    <input type="checkbox" (change)="selectContainerRowChange(chkSelection.checked, dataItem, idx)" [checked]="dataItem.Selected"
                                         id="chkbox-{{idx}}" class="k-checkbox" 
                                    />
                                    <label class="k-checkbox-label" for="chkbox-{{idx}}"></label>
                                </div> -->

                                <div class="k-form-field d-flex">
                                    <input #chkSelection type="checkbox" (change)="selectShipmentRow(chkSelection.checked, dataItem, idx)" [checked]="dataItem.Selected"
                                        id="chkbox-{{idx}}" class="k-checkbox" name="columnfilter" />
                                    <label class="k-checkbox-label" for="chkbox-{{idx}}"></label>
                                </div>
                            </ng-template>
                        </kendo-grid-checkbox-column>
                        <kendo-grid-column field="OPTM_BPCODE" width="110" title="{{'Outbound_Customer'|translate}}">                            
                        </kendo-grid-column>
                        <kendo-grid-column field="OPTM_SHIPTO" width="90" title="{{'PT_Ship_To'|translate}}"></kendo-grid-column>
                        <kendo-grid-column field="OPTM_SHIPMENT_CODE" width="110" title="{{'ShipmentCode'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem class="text-left">
                                <a class="dropdown-item" style="color: blue; " class="text-left" (click)="showShipmentList(dataItem.OPTM_SHIPMENTID)">{{dataItem.OPTM_SHIPMENT_CODE}}</a>
                                <!-- <a class="dropdown-item" style="color: gray; cursor: not-allowed; pointer-events: none;" *ngIf="isStageDiabled">Click here</a> -->
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column field="OPTM_SCH_DATETIME" width="70" title="{{'SchShipDate'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem>
                                {{dataItem.OPTM_SCH_DATETIME | date:dateFormat}}
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column field="NO_OF_CONTAINERS" class="text-right" width="50" title="{{'NoofContainers'|translate}}"></kendo-grid-column>

                        <kendo-grid-column field="DeliverySeq" [width]="45" title="{{'DeliverySeq'|translate}}" headerClass="text-left" class="text-left">
                            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                                <input type="number" #DelSeq class="form-control form-control-sm text-right" name="dataItem.DeliverySeq" id="DelSeq" value="{{dataItem.DeliverySeq}}"
                                    onkeydown="if(event.key==='.'||event.key==='e'||event.key==='='||event.key===','||event.key==='-'||event.key==='+'){event.preventDefault();}"
                                    (input)="updateDeliverySeq(DelSeq.value, dataItem, rowIndex)" min=0 trim>
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column field="DeliverToLocation" width="90" title="{{'DeliverToLocation'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                                <input type="text" #DeliverToLocation class="form-control form-control-sm" name="dataItem.DeliverToLocation" value="{{dataItem.DeliverToLocation}}"
                                    (input)="updateDeliverToLocation(DeliverToLocation.value, dataItem, rowIndex)">
                            </ng-template>
                        </kendo-grid-column>
                        
                    </kendo-grid>
                </div>
            </div>

            <div class="row" *ngIf='(orderCollection!==undefined && orderCollection!==null && orderCollection.length>0) && deliveryOptionType==1'>
                <div class="col-12">
                    <div *ngIf="deliveryOptionType==1">
                        <kendo-grid class="no-shadow" [kendoGridBinding]="orderCollection" [resizable]="true" [pageSize]="pageSize" [pageable]="pagable"
                            (pageChange)="pageChange($event)" [sortable]="true" [filterable]=isColumnFilter [groupable]=isColumnGroup
                            [height]=gridHeight (selectionChange)="openSelectedDeleveryItem($event)" [skip]="skip" [selectable]="true"
                            #gridItem>

                            <!-- grid for mobile start -->
                            <kendo-grid-column media="(max-width: 767px)" title="List" class="opti_mobile-grid-td">
                                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                                    <dl class="opti_mobile_grid_dl w-100">
                                        <dt class="d-flex align-items-center">{{'Outbound_OrderNo'|translate}}
                                            <button id="removeSelectedMeterial" (click)="removeOrder(idx,gridItem)" class="btn btn-danger k-button btn-sm btn-icon ml-auto">
                                                <span class="k-icon k-i-delete" role="presentation"></span>
                                            </button>
                                        </dt>
                                        <dd>{{ dataItem.DOCNUM }}</dd>
                                    </dl>
                                </ng-template>
                            </kendo-grid-column>
                            <!-- grid for mobile end -->

                            <kendo-grid-column media="(min-width: 768px)" field="DOCNUM" title="Order No">
                            </kendo-grid-column>
                            <kendo-grid-column headerClass="text-center" class="text-center" media="(min-width: 768px)" field="DOCNUM" [width]="80" title="{{'Delete'|translate}}"
                                *ngIf="deliveryOptionType==1">
                                <ng-template kendoGridCellTemplate let-idx="rowIndex">
                                    <button id="removeSelectedMeterial" (click)="removeOrder(idx,gridItem)" class="btn btn-danger k-button btn-sm btn-icon">
                                        <span class="k-icon k-i-delete" role="presentation"></span>
                                    </button>
                                </ng-template>
                            </kendo-grid-column>
                        </kendo-grid>
                    </div>
                </div>
            </div>
        </div>
        <div class="fix-footer-btnBar">
            <div class="col-sm-12 col-12">
                <hr />
            </div>
            <div class="col-sm-12 col-12">

                <button type="button" class="btn btn-danger k-button btn-sm btn-icon-with-text" (mousedown)="cancel()">
                    <span class="k-icon k-i-close-outline" role="presentation"></span> {{'Cancel'|translate}}</button>

                <button tabindex="-1" *ngIf="IsUDFEnabled == 'Y'" class="k-button k-primary btn custom-icon-button" type="button" (mousedown)="ShowUDF('Header', true)">
                    <span class="k-icon k-i-plus-outline "></span>{{'UDF'|translate}}
                </button>
                <button type="button" [hidden]='!(orderCollection!==undefined && orderCollection!==null && orderCollection.length>0)' (mousedown)="prepareDeleiveryCollection()"
                    class="btn btn-success k-button btn-sm btn-icon-with-text">
                    <span class="k-icon k-i-check" role="presentation"></span> {{'Deleiver'|translate}}</button>

                <button type="button" *ngIf="deliveryOptionType==2 && SelectedRowsforShipmentArr.length > 0" (mousedown)="prepareShipmentModel('delivery')"
                    class="btn btn-success k-button btn-sm btn-icon-with-text">
                    <span class="k-icon k-i-check" role="presentation"></span> {{'Deleiver'|translate}}</button>

                <button type="button" *ngIf="deliveryOptionType==1" class="btn btn-outline-secondary btn-sm btn-transparent btn-icon" [disabled]="!customerCode"
                    (click)="openCustSO(true)" roterLink="binTransfer" skipLocationChange>
                    <i class="opti-icon-arrow-next"></i>
                </button>

                <button type="button" id="Hid_outboundCustomerCodeScanBtn" style="visibility:hidden" (click)="hiddenScanCustCodeBtn()" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                    SB </button>

                <button type="button" id="Hid_OutCustSOScanBtn" style="visibility:hidden" (click)="hiddenScanSoBtn()" class="btn btn-light k-button btn-sm btn-transparent btn-icon separate-btn p-0">
                    SB </button>

            </div>
        </div>
    </form>
</div>

<span *ngIf="showUDF">
    <app-udfdialog [lookupfor]='displayArea' [templates]='templates' [UDFComponentData]='UDFComponentData' (UDFSaveClick)="getUDFSelectedItem($event)"></app-udfdialog>
</span>

<!-- Lookup -->
<span *ngIf="showLookup==true && showLookupLoader==false">
    <app-lookup [lookupfor]='lookupfor' [serviceData]='serviceData' (lookupvalue)="getLookupValue($event)"></app-lookup>
</span>
<!-- Loader -->
<div class="opti_loader full-section" *ngIf="showLookupLoader==true">
    <div class="opti_spinner"></div>
</div>


<!-- Dialog -->
<span *ngIf="showConfirmDialog">
    <app-comon-confirm-dialog [titleMessage]="dialogMsg" [fromWhere]="dialogFor" [noButtonText]="noButtonText" [yesButtonText]="yesButtonText"
        (isYesClick)="getConfirmDialogValue($event)"></app-comon-confirm-dialog>
</span>
<span *ngIf="showShipmentInfo==true">
    <app-shipmentinfo [serviceData]='ShipmentInfoData' [useContainer]='useContainer' (lookupOutputEvent)="getShipmentLookupEvent($event)"
        (lookupRowDeleteEvent)="shipmentRowDeleteEvent($event)"></app-shipmentinfo>
</span>




<kendo-dialog [width]="750" *ngIf="printDialog" (close)="closePrintDialog()" [minWidth]="250" [width]="450">
    <kendo-dialog-titlebar>
        {{'PrintOptions'|translate}}
    </kendo-dialog-titlebar>
    <!-- <div class="form-group" *ngIf="ShowPrintCount">
        <div class="input-group input-group-sm">
          <label class="col-sm-5 col-form-label">{{'NumberOfCopies'|translate}}</label>
          <div class="col-sm-7 p-0">
            <input type="number" #noOfCopy id="containerCode" name="containerCode" [(ngModel)]="numberOfCopies" class="form-control form-control-sm"
              placeholder="{{'NumberOfCopies'|translate}}">
          </div>
        </div>
      </div> -->
    <div class="px-3">
        <div class="form-group row">
            <div class="input-group input-group-sm">
                <button *ngIf="ShowPickListReport" class="btn btn-primary k-button btn-sm btn-icon-with-text" type="button" (click)="printOptionsClick(13)">{{'PickList'|translate}}
                </button>
                <button *ngIf="ShowPackListReport" class="btn btn-primary k-button btn-sm btn-icon-with-text" type="button" (click)="printOptionsClick(12)">{{'PackList'|translate}}
                </button>
                <button *ngIf="ShowBOLReport" class="btn btn-primary k-button btn-sm btn-icon-with-text" type="button" (click)="printOptionsClick(11)">{{'BOL'|translate}}
                </button>
            </div>
        </div>
    </div>
    <kendo-dialog-actions class="text-right">
        <button type="button" class="btn btn-danger k-button btn-sm btn-icon-with-text" (click)="closePrintDialog()">
            <span class="k-icon k-i-close-outline" role="presentation"></span> {{'Cancel'|translate}}</button>
    </kendo-dialog-actions>

    <div class="opti_loader full-section" *ngIf="showPDFLoading==true">
        <div class="opti_spinner"></div>
    </div>
</kendo-dialog>
<!--Pick list pack list and Bol PDF-->
<div>
    <app-display-pdf *ngIf="displayPDF1" [base64String]='base64String' [fileName]='fileName' (pdfClose)="closePDF($event)"></app-display-pdf>
</div>
<!--Pick list pack list and Bol PDF-->

<kendo-dialog [width]="700" [height]="400" *ngIf="dialogOpened" (close)="closeDialog()">
    <div class="new-custom-grid">
        <kendo-dialog-titlebar>
            {{'ShipmentDetail'|translate}}
        </kendo-dialog-titlebar>
        <div class="px-3">
            <div class="form-group row mt-2">
                <div class="input-group input-group-sm">
                    <kendo-grid [kendoGridBinding]="ShipmentDetail" [resizable]="true" [height]="270" [skip]="skip" #griditems>
                        <kendo-grid-column field="OPTM_SONO" width="70" title="{{'SalesOrder'|translate}}"></kendo-grid-column>
                        <kendo-grid-column class="text-right" field="OPTM_SOLINENO" width="60" title="{{'OrderLine'|translate}}"></kendo-grid-column>
                        <kendo-grid-column field="OPTM_ITEMCODE" width="150" title="{{'ItemCode'|translate}}"></kendo-grid-column>
                        <kendo-grid-column class="text-right" field="OPTM_SOLINEQTY" width="80" title="{{'OpenQty'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem>
                                {{dataItem.OPTM_SOLINEQTY |numberFormat}}
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column class="text-right" field="OPTM_SHPQTY_SUOM" width="80" title="{{'ShipQty'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem>
                                {{dataItem.OPTM_SHPQTY_SUOM |numberFormat}}
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column field="ShipDate" width="100" title="{{'DeliveryDate'|translate}}">
                            <ng-template kendoGridCellTemplate let-dataItem>
                                {{dataItem.ShipDate | date:dateFormat}}
                            </ng-template>
                        </kendo-grid-column>
                    </kendo-grid>
                </div>
            </div>
        </div>

        <kendo-dialog-actions>
            <button class="ml-1" kendoButton (click)="closeDialog()" primary="true">{{'Ok'|translate}}</button>
        </kendo-dialog-actions>
    </div>
</kendo-dialog>